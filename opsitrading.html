<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Binary Option Trading (Canvas + Cache)</title>
  <style>
    :root {
      --primary-color: #1e88e5;
      --bg-color: #f5f5f5;
      --text-color: #333;
      --card-bg: #fff;
      --up-color: #4caf50;
      --down-color: #f44336;
    }
    * { box-sizing:border-box; margin:0; padding:0; font-family:Poppins,sans-serif; }
    body { background:var(--bg-color); color:var(--text-color); }
    .header { display:flex; justify-content:space-between; align-items:center;
      background:var(--primary-color); color:#fff; padding:1rem; }
    .controls { display:flex; gap:.5rem; padding:1rem; }
    .controls select, .controls button { padding:.5rem; border-radius:4px; border:1px solid #ccc; }
    .btn-deposit { background:var(--primary-color); color:#fff; border:none; cursor:pointer; }
    .trading-panel { background:var(--card-bg); margin:1rem; padding:1rem;
      border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    #chartCanvas { width:100%; height:400px; border:1px solid #ddd; display:block; }
    .market-info { display:flex; justify-content:space-between; margin:.5rem 0; }
    .options { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .option-btn { flex:1; padding:.8rem; border:none; border-radius:4px;
      color:#fff; font-weight:bold; cursor:pointer; }
    #btn-up { background:var(--up-color); }
    #btn-down { background:var(--down-color); }
    .bet-controls { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .bet-controls input { flex:1; padding:.6rem; border-radius:4px; border:1px solid #ccc; }
    .btn-place { background:var(--primary-color); color:#fff; border:none; padding:.6rem 1rem;
      border-radius:4px; cursor:pointer; }
    .result { text-align:center; font-weight:bold; margin-top:.5rem; }
    .footer { text-align:center; margin:1rem; color:#777; }
  </style>
</head>
<body>
  <div class="header">
    <div>ðŸš€ Crash GOOGLE</div>
    <div>Saldo: <span id="balance">1000.00</span> USD</div>
  </div>

  <div class="controls">
    <select id="symbolSelect">
      <option value="EURUSD">EUR/USD</option>
      <option value="GBPUSD">GBP/USD</option>
      <option value="USDJPY">USD/JPY</option>
      <option value="AUDUSD">AUD/USD</option>
      <option value="USDCAD">USD/CAD</option>
      <option value="USDCHF">USD/CHF</option>
      <option value="NZDUSD">NZD/USD</option>
      <option value="XAUUSD">XAU/USD</option>
    </select>
    <select id="tfSelect">
      <option value="1">1m</option>
      <option value="5">5m</option>
      <option value="15">15m</option>
      <option value="60">1h</option>
    </select>
    <select id="durSelect">
      <option value="60">1 menit</option>
      <option value="120">2 menit</option>
      <option value="300">5 menit</option>
    </select>
    <button id="btnDeposit" class="btn-deposit">Deposit</button>
  </div>

  <section class="trading-panel">
    <canvas id="chartCanvas"></canvas>
    <div class="market-info">
      <div id="currSymbol">EUR/USD</div>
      <div>Durasi: <span id="currDur">60</span>s</div>
    </div>
    <div class="options">
      <button id="btnUp" class="option-btn">CALL â†‘</button>
      <button id="btnDown" class="option-btn">PUT â†“</button>
    </div>
    <div class="bet-controls">
      <input type="number" id="betAmount" placeholder="Jumlah (USD)" min="1">
      <button id="btnPlace" class="btn-place">Place Bet</button>
    </div>
    <div id="result" class="result"></div>
  </section>

  <div class="footer">Â© 2025 YourCompany</div>

  <script>
    // ---------- Setup ----------
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    function resize() {
      width = canvas.clientWidth;
      height = canvas.clientHeight;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    // controls & state
    const symbolSelect = document.getElementById('symbolSelect');
    const tfSelect     = document.getElementById('tfSelect');
    const durSelect    = document.getElementById('durSelect');
    const currSymbol   = document.getElementById('currSymbol');
    const currDur      = document.getElementById('currDur');
    const balanceEl    = document.getElementById('balance');
    const btnDeposit   = document.getElementById('btnDeposit');
    const btnUp        = document.getElementById('btnUp');
    const btnDown      = document.getElementById('btnDown');
    const betAmount    = document.getElementById('betAmount');
    const btnPlace     = document.getElementById('btnPlace');
    const resultEl     = document.getElementById('result');

    let balance = 1000;
    let tradeDur = +durSelect.value;
    let selection = null;
    let candles = [];
    let markers = [];
    let fakeInterval = null;

    // cache historis per symbol_timeframe
    const historyCache = {};

    // ---------- Helpers ----------
    function updateInfo() {
      currSymbol.textContent = symbolSelect.selectedOptions[0].text;
      tradeDur = +durSelect.value;
      currDur.textContent = tradeDur;
    }

    function genHistory(count=50) {
      const tf = +tfSelect.value;
      const now = Math.floor(Date.now()/1000);
      let base = 1 + (symbolSelect.value.charCodeAt(0) % 20) / 10;
      const data = [];
      for (let i = count; i > 0; i--) {
        const t = now - i * tf * 60;
        const open = base;
        const close = open * (1 + (Math.random()*0.02 - 0.01));
        const high = Math.max(open, close) * (1 + Math.random()*0.005);
        const low  = Math.min(open, close) * (1 - Math.random()*0.005);
        data.push({ time: t, open, high, low, close });
        base = close;
      }
      return data;
    }

    function startFakeTicks() {
      clearInterval(fakeInterval);
      fakeInterval = setInterval(() => {
        const last = candles[candles.length-1];
        const change = last.close * (Math.random()*0.004 - 0.002);
        last.close += change;
        last.high = Math.max(last.high, last.close);
        last.low  = Math.min(last.low, last.close);
        draw();
      }, 1000);
    }

    function getY(price) {
      const prices = candles.flatMap(c => [c.high, c.low]);
      const maxP = Math.max(...prices);
      const minP = Math.min(...prices);
      return ((maxP - price) / (maxP - minP)) * (height * 0.8) + height * 0.1;
    }

    // ---------- Drawing ----------
    function draw() {
      ctx.clearRect(0,0,width,height);
      if (!candles.length) return;
      const barW = width / candles.length * 0.8;
      candles.forEach((c,i) => {
        const x = i * (width / candles.length) + (width / candles.length - barW)/2;
        const yO = getY(c.open), yC = getY(c.close);
        const yH = getY(c.high), yL = getY(c.low);
        // wick
        ctx.strokeStyle = '#555';
        ctx.beginPath();
        ctx.moveTo(x+barW/2, yH);
        ctx.lineTo(x+barW/2, yL);
        ctx.stroke();
        // body
        ctx.fillStyle = c.close >= c.open ? 'var(--up-color)' : 'var(--down-color)';
        const by = Math.min(yO,yC), bh = Math.abs(yC-yO)||1;
        ctx.fillRect(x, by, barW, bh);
      });
      // markers
      markers.forEach(m => {
        const i = candles.findIndex(c => c.time === m.time);
        if (i<0) return;
        const x = i * (width / candles.length) + (width / candles.length)/2;
        const y = getY(m.price) + (m.type==='CALL'?10:-10);
        ctx.fillStyle = m.type==='CALL'?'green':'red';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(m.type, x, y);
      });
    }

    // ---------- Data & Events ----------
    function loadChart() {
      updateInfo();
      const key = symbolSelect.value + '_' + tfSelect.value;
      if (historyCache[key]) {
        candles = historyCache[key];
      } else {
        candles = genHistory();
        historyCache[key] = candles;
      }
      markers = [];
      draw();
      startFakeTicks();
    }

    symbolSelect.addEventListener('change', loadChart);
    tfSelect.addEventListener('change', loadChart);
    durSelect.addEventListener('change', () => updateInfo());
    btnDeposit.addEventListener('click', () => {
      const v = parseFloat(prompt('Jumlah deposit (USD):'));
      if (v>0) { balance += v; balanceEl.textContent = balance.toFixed(2); }
    });
    btnUp.addEventListener('click', () => selection='CALL');
    btnDown.addEventListener('click', () => selection='PUT');
    btnPlace.addEventListener('click', () => {
      if (!selection) return alert('Klik CALL atau PUT dulu');
      const bet = parseFloat(betAmount.value);
      if (!bet || bet<=0) return alert('Masukkan jumlah valid');
      const last = candles[candles.length-1];
      markers.push({ time:last.time, price:last.close, type:selection });
      draw();
      alert(`${selection} @ ${last.close.toFixed(4)} diterima`);
      setTimeout(() => {
        const win = Math.random()<0.5;
        if (win) {
          const p = bet*0.8; balance+=p;
          resultEl.textContent = `Menang +${p.toFixed(2)} USD`;
        } else {
          balance-=bet;
          resultEl.textContent = `Kalah -${bet.toFixed(2)} USD`;
        }
        balanceEl.textContent = balance.toFixed(2);
        selection=null; betAmount.value='';
      }, tradeDur*1000);
    });

    // init
    loadChart();
  </script>
</body>
</html>

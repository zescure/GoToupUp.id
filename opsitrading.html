<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Binary Option Trading (Consistent Price)</title>
  <style>
    :root {
      --primary-color: #1e88e5;
      --bg-color: #f5f5f5;
      --text-color: #333;
      --card-bg: #fff;
      --up-color: #4caf50;
      --down-color: #f44336;
    }
    * { box-sizing: border-box; margin:0; padding:0; font-family:Poppins,sans-serif; }
    body { background:var(--bg-color); color:var(--text-color); }
    .header { display:flex; justify-content:space-between; align-items:center;
      background:var(--primary-color); color:#fff; padding:1rem; }
    .controls { display:flex; gap:.5rem; padding:1rem; }
    .controls select, .controls button { padding:.5rem; border-radius:4px; border:1px solid #ccc; }
    .btn-deposit { background:var(--primary-color); color:#fff; border:none; cursor:pointer; }
    .trading-panel { background:var(--card-bg); max-width:960px; margin:1rem auto; padding:1rem;
      border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.1); overflow:hidden; }
    .chart-container { display:flex; flex-wrap:wrap; gap:1rem; }
    #chartCanvas { flex:1 1 0; max-width:100%; height:400px; border:1px solid #ddd; }
    .price-display {
      width:100px; padding:1rem; font-size:1.1rem;
      border-left:1px solid #ccc; text-align:center;
      display:flex; flex-direction:column; justify-content:center;
    }
    @media (max-width:600px) {
      .chart-container { flex-direction:column; }
      .price-display {
        width:100%; border-left:none; border-top:1px solid #ccc; padding-top:.5rem;
      }
    }
    .market-info { display:flex; justify-content:space-between; margin:.5rem 0; }
    .options { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .option-btn { flex:1; padding:.8rem; border:none; border-radius:4px;
      color:#fff; font-weight:bold; cursor:pointer; }
    #btnUp { background:var(--up-color); }
    #btnDown { background:var(--down-color); }
    .bet-controls { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .bet-controls input { flex:1; padding:.6rem; border-radius:4px; border:1px solid #ccc; }
    .btn-place { background:var(--primary-color); color:#fff; border:none; padding:.6rem 1rem;
      border-radius:4px; cursor:pointer; }
    .result { text-align:center; font-weight:bold; margin-top:.5rem; }
    .footer { text-align:center; margin:1rem; color:#777; }
  </style>
</head>
<body>
  <div class="header">
    <div>ðŸš€ Crash GOOGLE</div>
    <div>Saldo: <span id="balance">1000.00</span> USD</div>
  </div>

  <div class="controls">
    <select id="symbolSelect">
      <option value="EURUSD">EUR/USD</option>
      <option value="GBPUSD">GBP/USD</option>
      <option value="USDJPY">USD/JPY</option>
      <option value="AUDUSD">AUD/USD</option>
      <option value="USDCAD">USD/CAD</option>
      <option value="USDCHF">USD/CHF</option>
      <option value="NZDUSD">NZD/USD</option>
      <option value="XAUUSD">XAU/USD</option>
    </select>
    <select id="tfSelect">
      <option value="1">1m</option>
      <option value="5">5m</option>
      <option value="15">15m</option>
      <option value="60">1h</option>
    </select>
    <select id="durSelect">
      <option value="60">1 menit</option>
      <option value="120">2 menit</option>
      <option value="300">5 menit</option>
    </select>
    <button id="btnDeposit" class="btn-deposit">Deposit</button>
  </div>

  <section class="trading-panel">
    <div class="chart-container">
      <canvas id="chartCanvas"></canvas>
      <div class="price-display">
        <div>Harga</div>
        <div id="currentPrice">â€“</div>
      </div>
    </div>
    <div class="market-info">
      <div id="currSymbol">EUR/USD</div>
      <div>Durasi: <span id="currDur">60</span>s</div>
    </div>
    <div class="options">
      <button id="btnUp" class="option-btn">CALL â†‘</button>
      <button id="btnDown" class="option-btn">PUT â†“</button>
    </div>
    <div class="bet-controls">
      <input type="number" id="betAmount" placeholder="Jumlah (USD)" min="1">
      <button id="btnPlace" class="btn-place">Place Bet</button>
    </div>
    <div id="activeTrade" class="result" style="color:#1e88e5;"></div>
<div id="tradeHistory" style="margin-top:1rem; font-size:.9rem;">
  <h4>ðŸ“ˆ Riwayat Perdagangan</h4>
  <ul id="historyList" style="list-style:none; padding:0;"></ul>
</div>
  </section>

  <div class="footer">Â© 2025 YourCompany</div>

  <script>
    // ---------- Setup ----------
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');
    const priceEl = document.getElementById('currentPrice');
    let width, height;
    function resize() {
      width = canvas.clientWidth;
      height = canvas.clientHeight;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    // controls & state
    const symbolSelect = document.getElementById('symbolSelect');
    const tfSelect     = document.getElementById('tfSelect');
    const durSelect    = document.getElementById('durSelect');
    const currSymbol   = document.getElementById('currSymbol');
    const currDur      = document.getElementById('currDur');
    const balanceEl    = document.getElementById('balance');
    const btnDeposit   = document.getElementById('btnDeposit');
    const btnUp        = document.getElementById('btnUp');
    const btnDown      = document.getElementById('btnDown');
    const betAmount    = document.getElementById('betAmount');
    const btnPlace     = document.getElementById('btnPlace');
    const resultEl     = document.getElementById('result');

    let balance        = 1000;
    let tradeDur       = +durSelect.value;
    let selection      = null;
    let candles        = [];
    let markers        = [];
    let fakeInterval   = null;
    let lastPrice      = null;

    // cache historis per symbol_timeframe
    const historyCache = {};

    // ---------- Helpers ----------
    function updateInfo() {
      currSymbol.textContent = symbolSelect.selectedOptions[0].text;
      tradeDur = +durSelect.value;
      currDur.textContent = tradeDur;
    }

    function genHistory(basePrice, count = 50) {
      const tf = +tfSelect.value;
      const now = Math.floor(Date.now()/1000);
      let base = basePrice;
      const data = [];
      for (let i = count; i > 0; i--) {
        const t = now - i * tf * 60;
        const open = base;
        const close = open * (1 + (Math.random()*0.02 - 0.01));
        const high = Math.max(open, close) * (1 + Math.random()*0.005);
        const low  = Math.min(open, close) * (1 - Math.random()*0.005);
        data.push({ time: t, open, high, low, close });
        base = close;
      }
      return data;
    }

    function startFakeTicks() {
      clearInterval(fakeInterval);
      fakeInterval = setInterval(() => {
        const change = lastPrice * (Math.random()*0.004 - 0.002);
        lastPrice += change;
        const last = candles[candles.length-1];
        last.close = lastPrice;
        last.high  = Math.max(last.high, last.close);
        last.low   = Math.min(last.low, last.close);
        priceEl.textContent = lastPrice.toFixed(4);
        draw();
      }, 1000);
    }

    function getY(price) {
      const prices = candles.flatMap(c => [c.high, c.low]);
      const maxP = Math.max(...prices);
      const minP = Math.min(...prices);
      return ((maxP - price) / (maxP - minP)) * (height * 0.8) + height * 0.1;
    }

    // ---------- Drawing ----------
    function draw() {
      ctx.clearRect(0,0,width,height);
      if (!candles.length) return;
      const barW = width / candles.length * 0.8;
      candles.forEach((c,i) => {
        const x = i * (width / candles.length) + (width / candles.length - barW)/2;
        const yO = getY(c.open), yC = getY(c.close);
        const yH = getY(c.high), yL = getY(c.low);
        // wick
        ctx.strokeStyle = '#555';
        ctx.beginPath();
        ctx.moveTo(x+barW/2, yH);
        ctx.lineTo(x+barW/2, yL);
        ctx.stroke();
        // body
        ctx.fillStyle = c.close >= c.open ? 'var(--up-color)' : 'var(--down-color)';
        const by = Math.min(yO,yC), bh = Math.abs(yC-yO) || 1;
        ctx.fillRect(x, by, barW, bh);
      });
      // markers
      markers.forEach(m => {
        const i = candles.findIndex(c => c.time === m.time);
        if (i<0) return;
        const x = i * (width / candles.length) + (width / candles.length)/2;
        const y = getY(m.price) + (m.type==='CALL'?10:-10);
        ctx.fillStyle = m.type==='CALL' ? 'green' : 'red';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(m.type, x, y);
      });
    }

    // ---------- Data & Events ----------
    function loadChart() {
      updateInfo();
      const key = symbolSelect.value + '_' + tfSelect.value;
      // init lastPrice sekali
      if (lastPrice === null) {
        lastPrice = 1 + (symbolSelect.value.charCodeAt(0) % 20) / 10;
      }
      // ambil atau generate history
      if (historyCache[key]) {
        candles = historyCache[key];
      } else {
        candles = genHistory(lastPrice);
        historyCache[key] = candles;
      }
      lastPrice = candles[candles.length-1].close;
      markers = [];
      priceEl.textContent = lastPrice.toFixed(4);
      draw();
      startFakeTicks();
    }

    symbolSelect.addEventListener('change', loadChart);
    tfSelect.addEventListener('change', loadChart);
    durSelect.addEventListener('change', () => updateInfo());
    btnDeposit.addEventListener('click', () => {
      const v = parseFloat(prompt('Jumlah deposit (USD):'));
      if (v>0) { balance += v; balanceEl.textContent = balance.toFixed(2); }
    });
    btnPlace.addEventListener('click', () => {
  if (!selection) return alert('Klik CALL atau PUT dulu');
  const bet = parseFloat(betAmount.value);
  if (!bet || bet <= 0) return alert('Masukkan jumlah valid');
  if (bet > balance) return alert('Saldo tidak cukup');

  const last = candles[candles.length - 1];
  const entryPrice = last.close;
  const entryTime = Date.now();
  const expireTime = entryTime + tradeDur * 1000;

  markers.push({ time: last.time, price: entryPrice, type: selection });
  draw();

  let countdown = tradeDur;
  resultEl.textContent = '';
  activeTrade.innerHTML = `<strong>${selection}</strong> @ ${entryPrice.toFixed(4)} - Waktu tersisa: <span id="countdown">${countdown}</span> detik`;

  const countdownInterval = setInterval(() => {
    countdown--;
    const cd = document.getElementById('countdown');
    if (cd) cd.textContent = countdown;
  }, 1000);

  setTimeout(() => {
    clearInterval(countdownInterval);
    const win = Math.random() < 0.5;
    let tradeResult, resultText;

    if (win) {
      const profit = bet * 0.8;
      balance += profit;
      resultText = `Menang +${profit.toFixed(2)} USD`;
      tradeResult = `<li style="color:green;">${selection} @ ${entryPrice.toFixed(4)} â†’ Menang (+${profit.toFixed(2)} USD)</li>`;
    } else {
      balance -= bet;
      resultText = `Kalah -${bet.toFixed(2)} USD`;
      tradeResult = `<li style="color:red;">${selection} @ ${entryPrice.toFixed(4)} â†’ Kalah (-${bet.toFixed(2)} USD)</li>`;
    }

    balanceEl.textContent = balance.toFixed(2);
    resultEl.textContent = resultText;
    activeTrade.innerHTML = ''; // Clear active trade info
    document.getElementById('tradeHistory').insertAdjacentHTML('afterbegin', tradeResult);

    // Reset
    selection = null;
    betAmount.value = '';
  }, tradeDur * 1000);
});

    // start
    loadChart();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Crash GOOGLE - Binary Option Trading</title>
  <style>
    :root {
      --primary-color: #1e88e5;
      --bg-color: #f5f5f5;
      --text-color: #333;
      --card-bg: #fff;
      --up-color: #4caf50;
      --down-color: #f44336;
    }
    * { box-sizing:border-box; margin:0; padding:0; font-family:Poppins,sans-serif; }
    body { background:var(--bg-color); color:var(--text-color); }
    .header { display:flex; justify-content:space-between; align-items:center;
      background:var(--primary-color); color:#fff; padding:1rem; }
    .controls { display:flex; gap:.5rem; padding:1rem; }
    .controls select, .controls button { padding:.5rem; border-radius:4px; border:1px solid #ccc; }
    .btn-deposit { background:var(--primary-color); color:#fff; border:none; cursor:pointer; }
    .btn-withdraw { background:var(--down-color); color:#fff; border:none; cursor:pointer; }
    .trading-panel { background:var(--card-bg); max-width:960px; margin:1rem auto; padding:1rem;
      border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.1); overflow:hidden; }
    .chart-container { display:flex; flex-wrap:wrap; gap:1rem; }
    #chartCanvas { flex:1 1 0; width:100%; height:400px; border:1px solid #ddd; }
    .price-display {
      width:100px; padding:1rem; font-size:1.1rem;
      border-left:1px solid #ccc; text-align:center;
      display:flex; flex-direction:column; justify-content:center;
    }
    @media (max-width:600px) {
      .chart-container { flex-direction:column; }
      .price-display {
        width:100%; border-left:none; border-top:1px solid #ccc; padding-top:.5rem;
      }
    }
    .market-info { display:flex; justify-content:space-between; margin:.5rem 0; }
    .options { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .option-btn { flex:1; padding:.8rem; border:none; border-radius:4px;
      color:#fff; font-weight:bold; cursor:pointer; }
    #btnUp { background:var(--up-color); }
    #btnDown { background:var(--down-color); }
    .bet-controls { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .bet-controls input { flex:1; padding:.6rem; border-radius:4px; border:1px solid #ccc; }
    .result { text-align:center; font-weight:bold; margin-top:.5rem; }
    #activeTrade { text-align:center; margin-top:.5rem; color:#333; }
    #tradeHistory { list-style:none; padding:0; max-width:600px; margin:1rem auto; font-size:.9rem; }
    #tradeHistory li { margin-bottom:.3rem; }
    .footer { text-align:center; margin:1rem; color:#777; }

    /* Modal sama Promo/FAQ seperti sebelumnya... */
  </style>
</head>
<body>

  <div class="header">
    <div>ðŸš€ Crash GOOGLE</div>
    <div>
      Saldo: Rp. <span id="balance">25000.00</span>
    </div>
  </div>

  <p style="text-align:center; margin-top:.5rem;">Informasi: Market â€“ Timeframe â€“ Durasi</p>
  <div class="controls">
    <select id="symbolSelect">
      <option value="EURUSD">Polusi Index</option>
      <option value="GBPUSD">Mineral Index</option>
      <option value="USDJPY">Air Index</option>
      <option value="AUDUSD">Kesehatan Index</option>
      <option value="USDCAD">Kemiskinan Index</option>
      <option value="USDCHF">Lingkungan Index</option>
      <option value="NZDUSD">UMKM Index</option>
      <option value="XAUUSD">Demokrasi Index</option>
    </select>
    <select id="tfSelect">
      <option value="1">1m</option>
      <option value="5">5m</option>
      <option value="15">15m</option>
      <option value="60">1h</option>
    </select>
    <select id="durSelect">
      <option value="60">1 menit</option>
      <option value="120">2 menit</option>
      <option value="300">5 menit</option>
    </select>
    <button id="btnDeposit" class="btn-deposit">Deposit</button>
    <button id="btnWithdraw" class="btn-withdraw">Tarik Saldo</button>
  </div>

  <section class="trading-panel">
    <div class="chart-container">
      <canvas id="chartCanvas"></canvas>
      <div class="price-display">
        <div>Index Poin</div>
        <div id="currentPrice">â€“</div>
      </div>
    </div>
    <div class="market-info">
      <div id="currSymbol">Polusi Index</div>
      <div>Durasi: <span id="currDur">60</span>s</div>
    </div>
    <div class="options">
      <button id="btnUp" class="option-btn">Buy â†‘</button>
      <button id="btnDown" class="option-btn">Sell â†“</button>
    </div>
    <div class="bet-controls">
      <input type="number" id="betAmount" placeholder="Jumlah (Rupiah)" min="1">
    </div>
    <div id="result" class="result"></div>
    <div id="activeTrade"></div>
    <h3 style="text-align:center; margin-top:1rem;">Riwayat Perdagangan</h3>
    <ul id="tradeHistory"></ul>
  </section>

  <!-- Modal Deposit & Withdraw, Promo & FAQ di-skip di sini untuk ringkas -->

  <script>
    // --- State & Cache ---
    let balance = 25000;
    const balanceEl = document.getElementById('balance');
    balanceEl.textContent = balance.toFixed(2);

    const historyCache = {}; // { "symbol_tf": [ "<li>...</li>", ... ] }

    // --- Controls references ---
    const symbolSelect = document.getElementById('symbolSelect');
    const tfSelect     = document.getElementById('tfSelect');
    const durSelect    = document.getElementById('durSelect');
    const currSymbol   = document.getElementById('currSymbol');
    const currDur      = document.getElementById('currDur');
    const tradeHistory = document.getElementById('tradeHistory');

    // --- Chart & trading refs ---
    const canvas    = document.getElementById('chartCanvas');
    const ctx       = canvas.getContext('2d');
    const priceEl   = document.getElementById('currentPrice');
    const btnUp     = document.getElementById('btnUp');
    const btnDown   = document.getElementById('btnDown');
    const betAmount = document.getElementById('betAmount');
    const resultEl  = document.getElementById('result');
    const activeTrade = document.getElementById('activeTrade');

    // candles data per symbol_tf
    const candlesCache = {};
    let candles = [], markers = [], lastPrice = 1.2;
    let tradeDur = +durSelect.value;

    // --- Helpers ---
    function key() {
      return symbolSelect.value + '_' + tfSelect.value;
    }

    function loadHistoryUI() {
      const k = key();
      tradeHistory.innerHTML = (historyCache[k] || []).join('');
    }

    function saveHistoryItem(html) {
      const k = key();
      historyCache[k] = historyCache[k] || [];
      historyCache[k].unshift(html);
    }

    function genHistory(base, count=50) {
      const tf = +tfSelect.value;
      const now = Math.floor(Date.now()/1000);
      let b = base;
      const d = [];
      for (let i = count; i > 0; i--) {
        const t = now - i * tf * 60;
        const open = b;
        const close = open * (1 + (Math.random()*0.02 - 0.01));
        const high = Math.max(open, close) * (1 + Math.random()*0.005);
        const low  = Math.min(open, close) * (1 - Math.random()*0.005);
        d.push({ time: t*1000, open, high, low, close });
        b = close;
      }
      return d;
    }

    function loadChart() {
      currSymbol.textContent = symbolSelect.selectedOptions[0].text;
      currDur.textContent = tradeDur = +durSelect.value;

      const k = key();
      if (!candlesCache[k]) {
        lastPrice = 1 + (Math.random()); 
        candlesCache[k] = genHistory(lastPrice);
      }
      candles = candlesCache[k];
      lastPrice = candles[candles.length-1].close;
      markers = [];
      priceEl.textContent = lastPrice.toFixed(4);
      loadHistoryUI();
      draw();
      startTicks();
    }

    let tickInterval;
    function startTicks() {
      clearInterval(tickInterval);
      tickInterval = setInterval(() => {
        const change = lastPrice * (Math.random()*0.004 - 0.002);
        lastPrice += change;
        candles.push({
          time: Date.now(),
          open: candles[candles.length-1].close,
          high: Math.max(candles[candles.length-1].close, lastPrice),
          low: Math.min(candles[candles.length-1].close, lastPrice),
          close: lastPrice
        });
        if (candles.length > 50) candles.shift();
        priceEl.textContent = lastPrice.toFixed(4);
        draw();
      }, 1000);
    }

    function draw() {
      resize();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (!candles.length) return;
      const maxP = Math.max(...candles.flatMap(c=>[c.high]));
      const minP = Math.min(...candles.flatMap(c=>[c.low]));
      const w = canvas.width / candles.length * 0.8;
      candles.forEach((c,i) => {
        const x = i*(canvas.width/candles.length) + (canvas.width/candles.length - w)/2;
        const yOpen  = ((maxP-c.open)/(maxP-minP))*canvas.height;
        const yClose = ((maxP-c.close)/(maxP-minP))*canvas.height;
        const yHigh  = ((maxP-c.high)/(maxP-minP))*canvas.height;
        const yLow   = ((maxP-c.low)/(maxP-minP))*canvas.height;
        // wick
        ctx.strokeStyle = '#555';
        ctx.beginPath();
        ctx.moveTo(x+w/2, yHigh);
        ctx.lineTo(x+w/2, yLow);
        ctx.stroke();
        // body
        ctx.fillStyle = c.close >= c.open ? 'var(--up-color)' : 'var(--down-color)';
        ctx.fillRect(x, Math.min(yOpen,yClose), w, Math.abs(yClose-yOpen) || 1);
      });
      // markers
      markers.forEach(m => {
        const i = candles.findIndex(c=>c.time===m.time);
        if (i<0) return;
        const c = candles[i];
        const x = i*(canvas.width/candles.length)+(canvas.width/candles.length)/2;
        const y = ((maxP-m.price)/(maxP-minP))*canvas.height + (m.type==='Buy'? -10:10);
        ctx.fillStyle = m.type==='Buy'?'var(--up-color)':'var(--down-color)';
        ctx.font = '12px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(m.type, x, y);
      });
    }

    function resize(){
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
    }

    // --- Trading ---
    function placeTrade(type) {
      const bet = parseFloat(betAmount.value);
      if (!bet||bet<=0) return alert('Masukkan jumlah valid');
      if (bet>balance) return alert('Saldo tidak cukup');
      const entryPrice = lastPrice;
      const entryTime  = Date.now();
      markers.push({ time: entryTime, price: entryPrice, type });
      draw();

      let t = tradeDur;
      activeTrade.textContent = `${type} @ ${entryPrice.toFixed(4)} | Sisa waktu: ${t}s`;
      const iv = setInterval(()=>{
        t--;
        activeTrade.textContent = `${type} @ ${entryPrice.toFixed(4)} | Sisa waktu: ${t}s`;
        if (t<=0) {
          clearInterval(iv);
          const win = Math.random()<0.5;
          let text, color;
          if (win) {
            const p = bet*0.8; balance+=p;
            text = `Menang +${p.toFixed(2)} Rp`; color='green';
          } else {
            balance-=bet;
            text = `Kalah -${bet.toFixed(2)} Rp`; color='red';
          }
          balanceEl.textContent = balance.toFixed(2);
          resultEl.textContent = text;
          activeTrade.textContent = '';

          const liHtml = `<li style="color:${color};">
            ${new Date().toLocaleTimeString()} â€” ${type} @ ${entryPrice.toFixed(4)} â€” ${text}
          </li>`;
          saveHistoryItem(liHtml);
          tradeHistory.insertAdjacentHTML('afterbegin', liHtml);
          betAmount.value = '';
        }
      }, 1000);
    }

    // --- Events ---
    symbolSelect.addEventListener('change', loadChart);
    tfSelect.addEventListener('change', loadChart);
    durSelect.addEventListener('change', ()=>{
      currDur.textContent = tradeDur = +durSelect.value;
    });

    btnUp.addEventListener('click', ()=>placeTrade('Buy'));
    btnDown.addEventListener('click', ()=>placeTrade('Sell'));

    // --- Init ---
    resize();
    loadChart();

    // deposit/withdraw logic tetap sama seperti sebelumnya...
  </script>
</body>
</html>

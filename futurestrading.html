<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Crash GOOGLE - Binary Option Trading</title>
  <style>
    :root {
      --primary-color: #1e88e5;
      --bg-color: #f5f5f5;
      --text-color: #333;
      --card-bg: #fff;
      --up-color: #4caf50;
      --down-color: #f44336;
    }
    * { box-sizing:border-box; margin:0; padding:0; font-family:Poppins,sans-serif; }
    body { background:var(--bg-color); color:var(--text-color); }

    .header { display:flex; justify-content:space-between; align-items:center;
      background:var(--primary-color); color:#fff; padding:1rem; }
    .header .balance { font-weight:bold; }
    .controls { display:flex; gap:.5rem; padding:1rem; justify-content:center; background:#eee; }
    .controls select, .controls button {
      padding:.5rem; border-radius:4px; border:1px solid #ccc; background:#fff; cursor:pointer;
    }
    .controls .btn-deposit { background:#28a745; color:#fff; border:none; }
    .controls .btn-withdraw { background:#dc3545; color:#fff; border:none; }
    .controls .btn-deposit:hover { background:#218838; }
    .controls .btn-withdraw:hover { background:#c82333; }

    .trading-panel { background:var(--card-bg); max-width:960px; margin:1rem auto; padding:1rem;
      border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    .chart-container { display:flex; flex-wrap:wrap; gap:1rem; }
    #chartCanvas { flex:1 1 0; width:100%; height:300px; border:1px solid #ddd; }
    .price-display { width:100px; padding:1rem; font-size:1.1rem;
      border-left:1px solid #ccc; text-align:center; display:flex;
      flex-direction:column; justify-content:center; background:#f9f9f9;
    }
    .market-info { display:flex; justify-content:space-between; margin:.5rem 0; }
    .options { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .option-btn { flex:1; padding:.8rem; border:none; border-radius:4px;
      color:#fff; font-weight:bold; cursor:pointer; }
    #btnUp { background:var(--up-color); }
    #btnDown { background:var(--down-color); }

    .bet-controls { display:flex; gap:.5rem; margin-bottom:.5rem; }
    .bet-controls input { flex:1; padding:.6rem; border-radius:4px; border:1px solid #ccc; }
    .bet-controls input[type=number] { step:.01; }

    .result, #activeTrade { text-align:center; font-weight:bold; margin-top:.5rem; }
    #openPositions { max-width:600px; margin:1rem auto; }
    #openPositions h4 { margin-bottom:.5rem; }
    #tradeHistory { list-style:none; padding:0; max-width:600px; margin:1rem auto; font-size:.9rem; }
    #tradeHistory li { margin-bottom:.3rem; }

    .footer { text-align:center; margin:1rem; color:#777; }

    /* Modals, Promo, FAQ sama seperti sebelumnya, tidak diubah */
    .modal { display:none; position:fixed; z-index:10; left:0; top:0;
      width:100%; height:100%; background:rgba(0,0,0,0.4); overflow:auto; }
    .modal-content { background:#fff; margin:10% auto; padding:1.5rem;
      border-radius:8px; width:90%; max-width:400px; position:relative; }
    .modal-close { position:absolute; top:.5rem; right:.8rem; font-size:1.2rem; cursor:pointer; color:#666; }
    .modal-content h3, .promo h2 { color:var(--primary-color); }
    .promo, .faq { max-width:600px; margin:2rem auto; }
    .promo { padding:1.5rem; background:#fff; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); text-align:center; }
    .promo p { line-height:1.5; margin-bottom:1rem; }
    .promo .btn-play { padding:.6rem 1.2rem; background:var(--up-color); color:#fff; border-radius:4px; text-decoration:none; font-weight:600; }
    .faq-item { border-bottom:1px solid #ddd; }
    .faq-item summary { cursor:pointer; padding:1rem; list-style:none; background:#f9f9f9; font-weight:600; }
    .faq-item details[open] summary { background:#e0e0e0; }
    .faq-item p { padding:0 1rem 1rem; color:#333; }
  </style>
</head>
<body>

  <div class="header">
    <div>ðŸš€ Crash GOOGLE</div>
    <div class="balance">Saldo Real: Rp.<span id="balance">0.00</span></div>
  </div>

  <p style="text-align:center; margin-top:.5rem;">Informasi: Index â€“ Server â€“ Durasi</p>
  <div class="controls">
    <select id="symbolSelect">
      <option value="EURUSD">Polusi Index</option>
      <option value="GBPUSD">Mineral Index</option>
      <option value="USDJPY">Air Index</option>
      <option value="AUDUSD">Kesehatan Index</option>
      <option value="USDCAD">Kemiskinan Index</option>
      <option value="USDCHF">Lingkungan Index</option>
      <option value="NZDUSD">UMKM Index</option>
      <option value="XAUUSD">Demokrasi Index</option>
    </select>
    <select id="tfSelect">
      <option value="1">Global</option>
      <option value="5">Asia</option>
      <option value="15">Eropa</option>
      <option value="60">Amerika</option>
    </select>
    <select id="durSelect">
      <option value="60">1 menit</option>
      <option value="120">2 menit</option>
      <option value="300">5 menit</option>
    </select>
    <button id="btnDeposit" class="btn-deposit">Deposit</button>
    <button id="btnWithdraw" class="btn-withdraw">Tarik Saldo</button>
  </div>

  <section class="trading-panel">
    <div class="chart-container">
      <canvas id="chartCanvas"></canvas>
      <div class="price-display">
        <div>Index Poin</div>
        <div id="currentPrice">â€“</div>
      </div>
    </div>
    <div class="market-info">
      <div id="currSymbol">Polusi Index</div>
      <div>Durasi: <span id="currDur">60</span>s</div>
    </div>
    <div class="options">
      <button id="btnUp" class="option-btn">BELI</button>
      <button id="btnDown" class="option-btn">JUAL</button>
    </div>
    <div class="bet-controls">
      <input type="number" id="betAmount" placeholder="Lot (0.01â€”â€¦)">
    </div>
    <div id="result" class="result"></div>
    <div id="activeTrade" class="result"></div>
    <div id="openPositions"></div>
    <h3 style="text-align:center; margin-top:1rem;">Riwayat Perdagangan</h3>
    <ul id="tradeHistory"></ul>
  </section>

  <!-- modals, promo, faqâ€¦ (sama seperti di atas) -->

  <!-- skrip utama -->
  <script>
    // State & cache
    let balance = 0;
    const balanceEl = document.getElementById('balance');
    const historyCache = {};
    const candlesCache = {};
    let candles = [], markers = [], lastPrice = 1.2;
    let tradeDur = +document.getElementById('durSelect').value;

    // Posisi & lot
    let positions = [];
    const maxPositions = 2;
    const betAmount = document.getElementById('betAmount');

    // Controls
    const symbolSelect = document.getElementById('symbolSelect');
    const tfSelect     = document.getElementById('tfSelect');
    const durSelect    = document.getElementById('durSelect');
    const currSymbol   = document.getElementById('currSymbol');
    const currDur      = document.getElementById('currDur');
    const tradeHistory = document.getElementById('tradeHistory');

    // Chart & trading
    const canvas    = document.getElementById('chartCanvas');
    const ctx       = canvas.getContext('2d');
    const priceEl   = document.getElementById('currentPrice');
    const btnUp     = document.getElementById('btnUp');
    const btnDown   = document.getElementById('btnDown');
    const resultEl  = document.getElementById('result');
    const activeTrade = document.getElementById('activeTrade');
    const openList = document.getElementById('openPositions');

    function key() { return symbolSelect.value + '_' + tfSelect.value; }
    function loadHistoryUI() {
      const k = key();
      tradeHistory.innerHTML = historyCache[k]?.join('') || '';
    }
    function saveHistoryItem(html) {
      const k = key();
      historyCache[k] = historyCache[k]||[];
      historyCache[k].unshift(html);
    }

    function genHistory(base, count=50) {
      const tf = +tfSelect.value;
      const now = Date.now();
      let b = base, arr = [];
      for(let i=count;i>0;i--){
        const t = now - i*tf*60000;
        const open = b;
        const close = open*(1+(Math.random()*0.02-0.01));
        const high = Math.max(open,close)*(1+Math.random()*0.005);
        const low  = Math.min(open,close)*(1-Math.random()*0.005);
        arr.push({ time:t, open, high, low, close });
        b = close;
      }
      return arr;
    }

    function loadChart() {
      currSymbol.textContent = symbolSelect.selectedOptions[0].text;
      currDur.textContent = tradeDur = +durSelect.value;
      const k = key();
      if (!candlesCache[k]) {
        lastPrice = 1 + Math.random();
        candlesCache[k] = genHistory(lastPrice);
      }
      candles = candlesCache[k];
      lastPrice = candles[candles.length-1].close;
      markers = [];
      priceEl.textContent = lastPrice.toFixed(4);
      loadHistoryUI();
      draw();
      startTicks();
    }

    // rendering candlestick & wick tetap seperti sebelumnyaâ€¦
    function draw(){
      canvas.width = canvas.clientWidth;
      canvas.height= canvas.clientHeight;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if(!candles.length)return;
      const allP = candles.flatMap(c=>[c.high,c.low]), maxP=Math.max(...allP), minP=Math.min(...allP);
      const upColor=getComputedStyle(document.documentElement).getPropertyValue('--up-color').trim();
      const downColor=getComputedStyle(document.documentElement).getPropertyValue('--down-color').trim();
      const w=canvas.width/candles.length*0.8;
      candles.forEach((c,i)=>{
        const x=i*(canvas.width/candles.length)+(canvas.width/candles.length-w)/2;
        const yO=((maxP-c.open)/(maxP-minP))*canvas.height;
        const yC=((maxP-c.close)/(maxP-minP))*canvas.height;
        const yH=((maxP-c.high)/(maxP-minP))*canvas.height;
        const yL=((maxP-c.low)/(maxP-minP))*canvas.height;
        // wick
        ctx.strokeStyle='#000'; ctx.beginPath();
        ctx.moveTo(x+w/2,yH); ctx.lineTo(x+w/2,yL); ctx.stroke();
        // body
        ctx.fillStyle=c.close>=c.open?upColor:downColor;
        ctx.fillRect(x,Math.min(yO,yC),w,Math.max(1,Math.abs(yC-yO)));
      });
      // markersâ€¦
      markers.forEach(m=>{
        const idx=candles.findIndex(c=>c.time===m.time);
        if(idx<0)return;
        const x=idx*(canvas.width/candles.length)+(canvas.width/candles.length)/2;
        const y=((maxP-m.price)/(maxP-minP))*canvas.height+(m.type==='BUY'?-12:12);
        ctx.fillStyle=m.type==='BUY'?upColor:downColor;
        ctx.font='12px sans-serif';ctx.textAlign='center';
        ctx.fillText(m.type,x,y);
      });
      checkAutoClose();
    }

    // tick generator
    function startTicks(){
      setTimeout(tick,2500);
    }
    function tick(){
      const change=lastPrice*(Math.random()*0.01-0.005);
      const target=lastPrice+change;
      const candle={ time:Date.now(), open:lastPrice, high:lastPrice, low:lastPrice, close:lastPrice };
      candles.push(candle);
      if(candles.length>50) candles.shift();
      const frames=30; let frame=0;
      function animate(){
        frame++;
        const p=frame/frames;
        const price=lastPrice+(target-lastPrice)*p;
        candle.close=price;
        if(price>candle.high) candle.high=price;
        if(price<candle.low)  candle.low=price;
        priceEl.textContent=price.toFixed(4);
        draw();
        if(frame<frames) requestAnimationFrame(animate);
        else { lastPrice=target; setTimeout(tick,2500); }
      }
      requestAnimationFrame(animate);
    }

    // posisi & lot
    function renderPositions(){
      openList.innerHTML='<h4>Posisi Terbuka</h4>';
      positions.forEach((pos,i)=>{
        const diff=(lastPrice-pos.entry)*(pos.type==='BUY'?1:-1);
        const pnl=Math.round(diff*pos.amount);
        const div=document.createElement('div');
        div.style.display='flex';div.style.justifyContent='space-between';
        div.style.padding='.5rem';div.style.border='1px solid #ccc';div.style.marginBottom='.3rem';
        div.innerHTML=`
          <span>${i+1}. ${pos.type} @ ${pos.entry.toFixed(4)} | Lot ${pos.lot}</span>
          <span style="color:${pnl>=0?'green':'red'};">P/L: ${pnl} Rp</span>
          <button data-i="${i}" class="close-btn">Close</button>
        `;
        openList.append(div);
      });
      openList.querySelectorAll('.close-btn').forEach(btn=>{
        btn.onclick=()=>closePosition(+btn.dataset.i);
      });
    }
    function closePosition(idx){
      const pos=positions.splice(idx,1)[0];
      const diff=(lastPrice-pos.entry)*(pos.type==='BUY'?1:-1);
      const pnl=Math.round(diff*pos.amount);
      balance+=pnl; balanceEl.textContent=balance.toFixed(2);
      const html=`<li style="color:${pnl>=0?'green':'red'};">
        ${new Date().toLocaleTimeString()} â€” ${pos.type} @ ${pos.entry.toFixed(4)} â†’ Exit @ ${lastPrice.toFixed(4)} â€” ${pnl>=0?'Profit':'Loss'} ${pnl} Rp
      </li>`;
      saveHistoryItem(html);
      tradeHistory.insertAdjacentHTML('afterbegin',html);
      renderPositions();
    }

    function placeTrade(type){
      if(positions.length>=maxPositions) return alert(`Maks ${maxPositions} posisi bersamaan.`);
      const lot=parseFloat(betAmount.value);
      if(!lot||lot<0.01) return alert('Lot minimal 0.01');
      const amount=Math.round(lot*1500000);
      if(amount>balance) return alert('Saldo tidak cukup');
      const entry=lastPrice;
      balance-=amount; balanceEl.textContent=balance.toFixed(2);
      // TP/SL
      let tpInput=prompt('Autoâ€close PROFIT (poin)?'), slInput=prompt('Autoâ€close LOSS (poin)?');
      const tp=!isNaN(parseFloat(tpInput))?parseFloat(tpInput):null;
      const sl=!isNaN(parseFloat(slInput))?parseFloat(slInput):null;
      positions.push({type,entry,lot,amount,tp,sl});
      renderPositions();
      betAmount.value='';
    }

    function checkAutoClose(){
      let changed=false;
      positions=positions.filter(pos=>{
        const diff=(lastPrice-pos.entry)*(pos.type==='BUY'?1:-1);
        if((pos.tp!==null&&diff>=pos.tp)||(pos.sl!==null&&diff<=-pos.sl)){
          const pnl=Math.round(diff*pos.amount);
          balance+=pnl; balanceEl.textContent=balance.toFixed(2);
          const html=`<li style="color:${pnl>=0?'green':'red'};">
            ${new Date().toLocaleTimeString()} â€” ${pos.type} @ ${pos.entry.toFixed(4)} â†’ Exit @ ${lastPrice.toFixed(4)} â€” ${pnl>=0?'Profit':'Loss'} ${pnl} Rp (Auto)
          </li>`;
          saveHistoryItem(html);
          tradeHistory.insertAdjacentHTML('afterbegin',html);
          changed=true;
          return false;
        }
        return true;
      });
      if(changed) renderPositions();
    }

    // event & init
    symbolSelect.addEventListener('change',loadChart);
    tfSelect.addEventListener('change',loadChart);
    durSelect.addEventListener('change',()=>{currDur.textContent=tradeDur=+durSelect.value;});
    btnUp.addEventListener('click',()=>placeTrade('BUY'));
    btnDown.addEventListener('click',()=>placeTrade('SELL'));

    // deposit/withdraw logicâ€¦ (sama seperti sebelumnya)

    loadChart();
  </script>
</body>
</html>
